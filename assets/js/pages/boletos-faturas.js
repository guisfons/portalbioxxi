jQuery(document).ready(function ($) {    
    $('.btn.btn--green').on('click', function () {
        const idFilial = localStorage.getItem('idFilial');
        const codCli = localStorage.getItem('codCli');
        const dataInicio = formatarDataParaRequisicao($('#periodo-inicio').val());
        const dataFim = formatarDataParaRequisicao($('#periodo-fim').val());

        // Validar os campos obrigatórios
        if (!codCli || !dataInicio || !dataFim) {
            alert('Por favor, preencha todos os campos obrigatórios!');
            return;
        }

        // Construir a URL da requisição
        const url = `https://cmexxfab.com.br/api-homol/api/cliente/financeiro/faturas?idfilial=${idFilial}&codcli=${codCli}&data_ini=${dataInicio}&data_fim=${dataFim}`;

        // Fazer a requisição
        const accessToken = localStorage.getItem('access_token');
        if (!accessToken) {
            alert('Usuário não autenticado. Por favor, faça login.');
            window.location.href = '/login';
            return;
        }

        fetch(url, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Coligada': localStorage.getItem('coligadaId'),
                'Accept': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if(data.length === 0) {
                alert('Nenhum boleto encontrado!');
                return
            }
            
            gerarLinhasBoletos(data);
        })
        .catch(error => {
            console.error('Erro na requisição:', error);
        });
    })
})

// Função para gerar as linhas da tabela
function gerarLinhasBoletos(data) {
    const tabela = $('.table')
    const tbody = $('.table tbody');
    const dataTable = new DataTable(tabela.find('table'));
    dataTable.clear()
    tabela.find('table').DataTable().destroy();
    tbody.empty();
    
    data.forEach(item => {
        const row = $('<tr>');

        // Adicionar células com os dados principais
        // row.append(`<td><input type="checkbox" name="select" value="${item.IDLAN}"></td>`);
        row.append(`<td>${obterMesAno(item.DataEmissao)}</td>`);
        row.append(`<td>${item.NumeroDocumento}</td>`);
        row.append(`<td>${formatarDataParaTabela(item.DataVencimento)}</td>`);
        row.append(`<td>${item.SituacaoTitulo}</td>`);
        row.append(`<td>${formatarValor(item.Valor)}</td>`);

        // Criar célula para os links de ações
        const acoesCell = $('<td>Carregando...</td>');
        row.append(acoesCell);
        tbody.append(row);

        // Headers da requisição
        const accessToken = localStorage.getItem('access_token');
        const headers = {
            'Authorization': `Bearer ${accessToken}`,
            'Coligada': localStorage.getItem('coligadaId'),
            'Accept': 'application/pdf' // Expectativa de PDF na resposta
        };

        // Função para baixar e gerar um link para o arquivo
        function fetchAndCreateLink(url, fileSVG) {
            return fetch(url, { headers })
                .then(response => {
                    if (!response.ok) throw new Error(`Erro ${response.status}`);
                    return response.blob(); // Converter para Blob (arquivo)
                })
                .then(blob => {
                    const fileURL = URL.createObjectURL(blob); // Criar URL temporária
                    return `<a href="${fileURL}" download="${item.NumeroDocumento}" target="_blank">${fileSVG}</a>`;
                })
                .catch(() => null); // Retorna null se houver erro
        }

        // Criar as URLs de requisição
        const requests = [];

        if (item.IDLAN) {
            requests.push(fetchAndCreateLink(
                `https://cmexxfab.com.br/api-homol/api/cliente/financeiro/fatura/boleto?idlan=${item.IDLAN}&codcoligada=${item.codcoligada}`,
                `<svg width="40" height="35" viewBox="0 0 40 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 16V12C20 11.7 19.9 11.5 19.7 11.3L12.7 4.3C12.5 4.1 12.3 4 12 4H2C0.9 4 0 4.9 0 6V30C0 31.1 0.9 32 2 32H18V30H2V6H10V12C10 13.1 10.9 14 12 14H18V16H20ZM12 12V6.4L17.6 12H12Z" fill="#0083CA"/><path d="M4.702 26V20.096C4.702 19.94 4.756 19.814 4.864 19.718C4.972 19.622 5.104 19.574 5.26 19.574H7.465C8.041 19.574 8.512 19.727 8.878 20.033C9.25 20.333 9.436 20.732 9.436 21.23C9.436 21.536 9.358 21.803 9.202 22.031C9.052 22.253 8.851 22.424 8.599 22.544V22.553C8.947 22.631 9.226 22.814 9.436 23.102C9.646 23.384 9.751 23.729 9.751 24.137C9.751 24.695 9.565 25.145 9.193 25.487C8.827 25.829 8.329 26 7.699 26H4.702ZM6.007 22.157H7.249C7.537 22.157 7.759 22.088 7.915 21.95C8.077 21.812 8.158 21.629 8.158 21.401C8.158 21.143 8.071 20.945 7.897 20.807C7.729 20.669 7.492 20.6 7.186 20.6H6.007V22.157ZM6.007 24.974H7.348C7.666 24.974 7.918 24.893 8.104 24.731C8.296 24.569 8.392 24.353 8.392 24.083C8.392 23.789 8.299 23.561 8.113 23.399C7.927 23.237 7.66 23.156 7.312 23.156H6.007V24.974ZM13.6015 26.099C12.6475 26.099 11.8795 25.799 11.2975 25.199C10.7155 24.599 10.4245 23.804 10.4245 22.814C10.4245 21.806 10.7155 20.996 11.2975 20.384C11.8855 19.766 12.6595 19.457 13.6195 19.457C14.5735 19.457 15.3415 19.763 15.9235 20.375C16.5055 20.987 16.7965 21.794 16.7965 22.796C16.7965 23.792 16.5025 24.593 15.9145 25.199C15.3325 25.799 14.5615 26.099 13.6015 26.099ZM13.6195 24.965C14.1955 24.965 14.6485 24.776 14.9785 24.398C15.3145 24.014 15.4825 23.477 15.4825 22.787C15.4825 22.085 15.3145 21.545 14.9785 21.167C14.6485 20.783 14.1955 20.591 13.6195 20.591C13.0375 20.591 12.5785 20.783 12.2425 21.167C11.9065 21.545 11.7385 22.085 11.7385 22.787C11.7385 23.483 11.9065 24.02 12.2425 24.398C12.5785 24.776 13.0375 24.965 13.6195 24.965ZM18.3812 26C18.2312 26 18.1052 25.952 18.0032 25.856C17.9072 25.754 17.8592 25.628 17.8592 25.478V19.574H19.1462V24.92H21.9992V26H18.3812ZM27.0908 20.663H24.1298V22.184H26.7938V23.273H24.1298V24.902H27.0098V26H22.8338V20.096C22.8338 19.94 22.8878 19.814 22.9958 19.718C23.1038 19.622 23.2328 19.574 23.3828 19.574H27.0908V20.663ZM32.5962 19.574V20.654H30.7692V26H29.4732V20.654H27.6282V19.574H32.5962ZM36.0399 26.099C35.0859 26.099 34.3179 25.799 33.7359 25.199C33.1539 24.599 32.8629 23.804 32.8629 22.814C32.8629 21.806 33.1539 20.996 33.7359 20.384C34.3239 19.766 35.0979 19.457 36.0579 19.457C37.0119 19.457 37.7799 19.763 38.3619 20.375C38.9439 20.987 39.2349 21.794 39.2349 22.796C39.2349 23.792 38.9409 24.593 38.3529 25.199C37.7709 25.799 36.9999 26.099 36.0399 26.099ZM36.0579 24.965C36.6339 24.965 37.0869 24.776 37.4169 24.398C37.7529 24.014 37.9209 23.477 37.9209 22.787C37.9209 22.085 37.7529 21.545 37.4169 21.167C37.0869 20.783 36.6339 20.591 36.0579 20.591C35.4759 20.591 35.0169 20.783 34.6809 21.167C34.3449 21.545 34.1769 22.085 34.1769 22.787C34.1769 23.483 34.3449 24.02 34.6809 24.398C35.0169 24.776 35.4759 24.965 36.0579 24.965Z" fill="#0083CA"/><path d="M28.9954 15C28.8367 14.9993 28.6805 14.9608 28.5397 14.8878C28.3989 14.8147 28.2774 14.7092 28.1854 14.58L23.1854 7.58C23.0791 7.43075 23.0159 7.25517 23.0026 7.07243C22.9894 6.8897 23.0265 6.70683 23.1101 6.54379C23.1937 6.38075 23.3205 6.2438 23.4766 6.1479C23.6327 6.05201 23.8122 6.00084 23.9954 6H24.9954V1C24.9954 0.734784 25.1007 0.480429 25.2883 0.292892C25.4758 0.105356 25.7302 0 25.9954 0H31.9954C32.2606 0 32.515 0.105356 32.7025 0.292892C32.89 0.480429 32.9954 0.734784 32.9954 1V6H33.9954C34.1786 6.00084 34.3581 6.05201 34.5142 6.1479C34.6703 6.2438 34.7971 6.38075 34.8807 6.54379C34.9642 6.70683 35.0014 6.8897 34.9882 7.07243C34.9749 7.25517 34.9117 7.43075 34.8054 7.58L29.8054 14.58C29.7134 14.7092 29.5919 14.8147 29.4511 14.8878C29.3102 14.9608 29.154 14.9993 28.9954 15ZM25.9354 8L28.9954 12.28L32.0554 8H31.9954C31.7302 8 31.4758 7.89464 31.2883 7.70711C31.1007 7.51957 30.9954 7.26522 30.9954 7V2H26.9954V7C26.9954 7.26522 26.89 7.51957 26.7025 7.70711C26.515 7.89464 26.2606 8 25.9954 8H25.9354Z" fill="#0083CA"/></svg>`
            ));
            requests.push(fetchAndCreateLink(
                `https://cmexxfab.com.br/api-homol/api/cliente/financeiro/fatura/pdf?idlan=${item.IDLAN}&codcoligada=${item.codcoligada}`,
                `<svg width="48" height="35" viewBox="0 0 48 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 16V12C20 11.7 19.9 11.5 19.7 11.3L12.7 4.3C12.5 4.1 12.3 4 12 4H2C0.9 4 0 4.9 0 6V30C0 31.1 0.9 32 2 32H18V30H2V6H10V12C10 13.1 10.9 14 12 14H18V16H20ZM12 12V6.4L17.6 12H12Z" fill="#0083CA"/><path d="M8.995 19.574H10.174V25.649C10.174 25.775 10.111 25.877 9.985 25.955C9.865 26.027 9.712 26.063 9.526 26.063C9.322 26.063 9.163 26.036 9.049 25.982C8.941 25.928 8.839 25.835 8.743 25.703L5.899 21.68V26H4.702V20.051C4.702 19.877 4.765 19.748 4.891 19.664C5.017 19.58 5.182 19.538 5.386 19.538C5.626 19.538 5.8 19.574 5.908 19.646C6.022 19.718 6.154 19.862 6.304 20.078L8.995 23.84V19.574ZM14.4276 26.099C13.4736 26.099 12.7056 25.799 12.1236 25.199C11.5416 24.599 11.2506 23.804 11.2506 22.814C11.2506 21.806 11.5416 20.996 12.1236 20.384C12.7116 19.766 13.4856 19.457 14.4456 19.457C15.3996 19.457 16.1676 19.763 16.7496 20.375C17.3316 20.987 17.6226 21.794 17.6226 22.796C17.6226 23.792 17.3286 24.593 16.7406 25.199C16.1586 25.799 15.3876 26.099 14.4276 26.099ZM14.4456 24.965C15.0216 24.965 15.4746 24.776 15.8046 24.398C16.1406 24.014 16.3086 23.477 16.3086 22.787C16.3086 22.085 16.1406 21.545 15.8046 21.167C15.4746 20.783 15.0216 20.591 14.4456 20.591C13.8636 20.591 13.4046 20.783 13.0686 21.167C12.7326 21.545 12.5646 22.085 12.5646 22.787C12.5646 23.483 12.7326 24.02 13.0686 24.398C13.4046 24.776 13.8636 24.965 14.4456 24.965ZM22.8579 19.574V20.654H21.0309V26H19.7349V20.654H17.8899V19.574H22.8579ZM27.2365 26L26.6965 24.407H24.3475L23.8075 26H22.4665L24.6445 20.051C24.7705 19.709 25.0615 19.538 25.5175 19.538C25.9795 19.538 26.2735 19.712 26.3995 20.06L28.5775 26H27.2365ZM24.7165 23.318H26.3275L25.5175 20.933L24.7165 23.318ZM33.5706 19.574C34.2846 19.574 34.8306 19.775 35.2086 20.177C35.5926 20.573 35.7846 21.077 35.7846 21.689C35.7846 22.373 35.5866 22.898 35.1906 23.264C34.7946 23.624 34.2246 23.804 33.4806 23.804H32.3916V26H31.0956V20.096C31.0956 19.946 31.1466 19.823 31.2486 19.727C31.3506 19.625 31.4766 19.574 31.6266 19.574H33.5706ZM33.4356 22.733C34.1316 22.733 34.4796 22.382 34.4796 21.68C34.4796 21.356 34.3866 21.104 34.2006 20.924C34.0206 20.744 33.7626 20.654 33.4266 20.654H32.3916V22.733H33.4356ZM36.7118 26V20.096C36.7118 19.94 36.7658 19.814 36.8738 19.718C36.9818 19.622 37.1138 19.574 37.2698 19.574H39.1688C39.8048 19.574 40.3628 19.721 40.8428 20.015C41.3228 20.309 41.6828 20.696 41.9228 21.176C42.1628 21.656 42.2828 22.184 42.2828 22.76C42.2828 23.666 42.0038 24.434 41.4458 25.064C40.8878 25.688 40.1258 26 39.1598 26H36.7118ZM38.0078 24.92H39.0698C39.6458 24.92 40.1108 24.719 40.4648 24.317C40.8188 23.909 40.9958 23.39 40.9958 22.76C40.9958 22.172 40.8248 21.674 40.4828 21.266C40.1468 20.858 39.6908 20.654 39.1148 20.654H38.0078V24.92ZM47.2764 20.663H44.4414V22.184H46.8984V23.273H44.4414V26H43.1454V20.096C43.1454 19.94 43.1994 19.814 43.3074 19.718C43.4154 19.622 43.5444 19.574 43.6944 19.574H47.2764V20.663Z" fill="#0083CA"/><path d="M30.9954 15C30.8367 14.9993 30.6805 14.9608 30.5397 14.8878C30.3989 14.8147 30.2774 14.7092 30.1854 14.58L25.1854 7.58C25.0791 7.43075 25.0159 7.25517 25.0026 7.07243C24.9894 6.8897 25.0265 6.70683 25.1101 6.54379C25.1937 6.38075 25.3205 6.2438 25.4766 6.1479C25.6327 6.05201 25.8122 6.00084 25.9954 6H26.9954V1C26.9954 0.734784 27.1007 0.480429 27.2883 0.292892C27.4758 0.105356 27.7302 0 27.9954 0H33.9954C34.2606 0 34.515 0.105356 34.7025 0.292892C34.89 0.480429 34.9954 0.734784 34.9954 1V6H35.9954C36.1786 6.00084 36.3581 6.05201 36.5142 6.1479C36.6703 6.2438 36.7971 6.38075 36.8807 6.54379C36.9642 6.70683 37.0014 6.8897 36.9882 7.07243C36.9749 7.25517 36.9117 7.43075 36.8054 7.58L31.8054 14.58C31.7134 14.7092 31.5919 14.8147 31.4511 14.8878C31.3102 14.9608 31.154 14.9993 30.9954 15ZM27.9354 8L30.9954 12.28L34.0554 8H33.9954C33.7302 8 33.4758 7.89464 33.2883 7.70711C33.1007 7.51957 32.9954 7.26522 32.9954 7V2H28.9954V7C28.9954 7.26522 28.89 7.51957 28.7025 7.70711C28.515 7.89464 28.2606 8 27.9954 8H27.9354Z" fill="#0083CA"/></svg>`
            ));
        }

        if (item.NumeroMov) {
            requests.push(fetchAndCreateLink(
                `https://cmexxfab.com.br/api-homol/api/cliente/financeiro/fatura/rps?nummov=${item.NumeroMov}&codcoligada=${item.codcoligada}`,
                `<svg width="47" height="35" viewBox="0 0 47 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 16V12C20 11.7 19.9 11.5 19.7 11.3L12.7 4.3C12.5 4.1 12.3 4 12 4H2C0.9 4 0 4.9 0 6V30C0 31.1 0.9 32 2 32H18V30H2V6H10V12C10 13.1 10.9 14 12 14H18V16H20ZM12 12V6.4L17.6 12H12Z" fill="#0083CA"/><path d="M8.995 19.574H10.174V25.649C10.174 25.775 10.111 25.877 9.985 25.955C9.865 26.027 9.712 26.063 9.526 26.063C9.322 26.063 9.163 26.036 9.049 25.982C8.941 25.928 8.839 25.835 8.743 25.703L5.899 21.68V26H4.702V20.051C4.702 19.877 4.765 19.748 4.891 19.664C5.017 19.58 5.182 19.538 5.386 19.538C5.626 19.538 5.8 19.574 5.908 19.646C6.022 19.718 6.154 19.862 6.304 20.078L8.995 23.84V19.574ZM14.4276 26.099C13.4736 26.099 12.7056 25.799 12.1236 25.199C11.5416 24.599 11.2506 23.804 11.2506 22.814C11.2506 21.806 11.5416 20.996 12.1236 20.384C12.7116 19.766 13.4856 19.457 14.4456 19.457C15.3996 19.457 16.1676 19.763 16.7496 20.375C17.3316 20.987 17.6226 21.794 17.6226 22.796C17.6226 23.792 17.3286 24.593 16.7406 25.199C16.1586 25.799 15.3876 26.099 14.4276 26.099ZM14.4456 24.965C15.0216 24.965 15.4746 24.776 15.8046 24.398C16.1406 24.014 16.3086 23.477 16.3086 22.787C16.3086 22.085 16.1406 21.545 15.8046 21.167C15.4746 20.783 15.0216 20.591 14.4456 20.591C13.8636 20.591 13.4046 20.783 13.0686 21.167C12.7326 21.545 12.5646 22.085 12.5646 22.787C12.5646 23.483 12.7326 24.02 13.0686 24.398C13.4046 24.776 13.8636 24.965 14.4456 24.965ZM22.8579 19.574V20.654H21.0309V26H19.7349V20.654H17.8899V19.574H22.8579ZM27.2365 26L26.6965 24.407H24.3475L23.8075 26H22.4665L24.6445 20.051C24.7705 19.709 25.0615 19.538 25.5175 19.538C25.9795 19.538 26.2735 19.712 26.3995 20.06L28.5775 26H27.2365ZM24.7165 23.318H26.3275L25.5175 20.933L24.7165 23.318ZM34.4076 26L33.0126 23.588H32.3466V26H31.0956V20.096C31.0956 19.946 31.1466 19.823 31.2486 19.727C31.3506 19.625 31.4766 19.574 31.6266 19.574H33.5616C34.2576 19.574 34.7916 19.757 35.1636 20.123C35.5416 20.489 35.7306 20.978 35.7306 21.59C35.7306 22.592 35.2596 23.219 34.3176 23.471L35.8836 26H34.4076ZM32.3466 20.654V22.553H33.3816C34.0776 22.553 34.4256 22.229 34.4256 21.581C34.4256 21.293 34.3386 21.068 34.1646 20.906C33.9906 20.738 33.7356 20.654 33.3996 20.654H32.3466ZM39.3362 19.574C40.0502 19.574 40.5962 19.775 40.9742 20.177C41.3582 20.573 41.5502 21.077 41.5502 21.689C41.5502 22.373 41.3522 22.898 40.9562 23.264C40.5602 23.624 39.9902 23.804 39.2462 23.804H38.1572V26H36.8612V20.096C36.8612 19.946 36.9122 19.823 37.0142 19.727C37.1162 19.625 37.2422 19.574 37.3922 19.574H39.3362ZM39.2012 22.733C39.8972 22.733 40.2452 22.382 40.2452 21.68C40.2452 21.356 40.1522 21.104 39.9662 20.924C39.7862 20.744 39.5282 20.654 39.1922 20.654H38.1572V22.733H39.2012ZM44.1985 26.099C43.7425 26.099 43.3075 26.018 42.8935 25.856C42.4855 25.688 42.1495 25.454 41.8855 25.154L42.5425 24.299C43.0165 24.773 43.5685 25.01 44.1985 25.01C44.5645 25.01 44.8525 24.932 45.0625 24.776C45.2725 24.614 45.3775 24.413 45.3775 24.173C45.3775 24.095 45.3655 24.023 45.3415 23.957C45.3235 23.891 45.2845 23.831 45.2245 23.777C45.1705 23.723 45.1225 23.681 45.0805 23.651C45.0445 23.615 44.9725 23.576 44.8645 23.534C44.7565 23.486 44.6785 23.453 44.6305 23.435C44.5825 23.417 44.4865 23.387 44.3425 23.345C44.2045 23.297 44.1115 23.264 44.0635 23.246C43.7815 23.15 43.5415 23.057 43.3435 22.967C43.1515 22.871 42.9565 22.751 42.7585 22.607C42.5605 22.457 42.4105 22.277 42.3085 22.067C42.2065 21.851 42.1555 21.605 42.1555 21.329C42.1555 20.741 42.3685 20.282 42.7945 19.952C43.2205 19.622 43.7725 19.457 44.4505 19.457C45.1945 19.457 45.8605 19.655 46.4485 20.051L45.9175 20.96C45.4315 20.654 44.9545 20.501 44.4865 20.501C44.1685 20.501 43.9105 20.57 43.7125 20.708C43.5145 20.84 43.4155 21.026 43.4155 21.266C43.4155 21.356 43.4275 21.437 43.4515 21.509C43.4755 21.581 43.5265 21.65 43.6045 21.716C43.6825 21.776 43.7455 21.827 43.7935 21.869C43.8415 21.905 43.9345 21.95 44.0725 22.004C44.2105 22.058 44.3035 22.094 44.3515 22.112C44.4055 22.13 44.5225 22.169 44.7025 22.229C44.9965 22.325 45.2395 22.418 45.4315 22.508C45.6295 22.598 45.8305 22.715 46.0345 22.859C46.2445 23.003 46.4005 23.183 46.5025 23.399C46.6045 23.609 46.6555 23.852 46.6555 24.128C46.6555 24.698 46.4245 25.169 45.9625 25.541C45.5005 25.913 44.9125 26.099 44.1985 26.099Z" fill="#0083CA"/><path d="M29.9954 15C29.8367 14.9993 29.6805 14.9608 29.5397 14.8878C29.3989 14.8147 29.2774 14.7092 29.1854 14.58L24.1854 7.58C24.0791 7.43075 24.0159 7.25517 24.0026 7.07243C23.9894 6.8897 24.0265 6.70683 24.1101 6.54379C24.1937 6.38075 24.3205 6.2438 24.4766 6.1479C24.6327 6.05201 24.8122 6.00084 24.9954 6H25.9954V1C25.9954 0.734784 26.1007 0.480429 26.2883 0.292892C26.4758 0.105356 26.7302 0 26.9954 0H32.9954C33.2606 0 33.515 0.105356 33.7025 0.292892C33.89 0.480429 33.9954 0.734784 33.9954 1V6H34.9954C35.1786 6.00084 35.3581 6.05201 35.5142 6.1479C35.6703 6.2438 35.7971 6.38075 35.8807 6.54379C35.9642 6.70683 36.0014 6.8897 35.9882 7.07243C35.9749 7.25517 35.9117 7.43075 35.8054 7.58L30.8054 14.58C30.7134 14.7092 30.5919 14.8147 30.4511 14.8878C30.3102 14.9608 30.154 14.9993 29.9954 15ZM26.9354 8L29.9954 12.28L33.0554 8H32.9954C32.7302 8 32.4758 7.89464 32.2883 7.70711C32.1007 7.51957 31.9954 7.26522 31.9954 7V2H27.9954V7C27.9954 7.26522 27.89 7.51957 27.7025 7.70711C27.515 7.89464 27.2606 8 26.9954 8H26.9354Z" fill="#0083CA"/></svg>`
            ));
        }

        if (item.IDMOV) {
            requests.push(fetchAndCreateLink(
                `https://cmexxfab.com.br/api-homol/api/cliente/financeiro/fatura/xml?idmov=${item.IDMOV}&codcoligada=${item.codcoligada}`,
                `<svg width="50" height="35" viewBox="0 0 50 35" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 16V12C20 11.7 19.9 11.5 19.7 11.3L12.7 4.3C12.5 4.1 12.3 4 12 4H2C0.9 4 0 4.9 0 6V30C0 31.1 0.9 32 2 32H18V30H2V6H10V12C10 13.1 10.9 14 12 14H18V16H20ZM12 12V6.4L17.6 12H12Z" fill="#0083CA"/><path d="M8.995 19.574H10.174V25.649C10.174 25.775 10.111 25.877 9.985 25.955C9.865 26.027 9.712 26.063 9.526 26.063C9.322 26.063 9.163 26.036 9.049 25.982C8.941 25.928 8.839 25.835 8.743 25.703L5.899 21.68V26H4.702V20.051C4.702 19.877 4.765 19.748 4.891 19.664C5.017 19.58 5.182 19.538 5.386 19.538C5.626 19.538 5.8 19.574 5.908 19.646C6.022 19.718 6.154 19.862 6.304 20.078L8.995 23.84V19.574ZM14.4276 26.099C13.4736 26.099 12.7056 25.799 12.1236 25.199C11.5416 24.599 11.2506 23.804 11.2506 22.814C11.2506 21.806 11.5416 20.996 12.1236 20.384C12.7116 19.766 13.4856 19.457 14.4456 19.457C15.3996 19.457 16.1676 19.763 16.7496 20.375C17.3316 20.987 17.6226 21.794 17.6226 22.796C17.6226 23.792 17.3286 24.593 16.7406 25.199C16.1586 25.799 15.3876 26.099 14.4276 26.099ZM14.4456 24.965C15.0216 24.965 15.4746 24.776 15.8046 24.398C16.1406 24.014 16.3086 23.477 16.3086 22.787C16.3086 22.085 16.1406 21.545 15.8046 21.167C15.4746 20.783 15.0216 20.591 14.4456 20.591C13.8636 20.591 13.4046 20.783 13.0686 21.167C12.7326 21.545 12.5646 22.085 12.5646 22.787C12.5646 23.483 12.7326 24.02 13.0686 24.398C13.4046 24.776 13.8636 24.965 14.4456 24.965ZM22.8579 19.574V20.654H21.0309V26H19.7349V20.654H17.8899V19.574H22.8579ZM27.2365 26L26.6965 24.407H24.3475L23.8075 26H22.4665L24.6445 20.051C24.7705 19.709 25.0615 19.538 25.5175 19.538C25.9795 19.538 26.2735 19.712 26.3995 20.06L28.5775 26H27.2365ZM24.7165 23.318H26.3275L25.5175 20.933L24.7165 23.318ZM35.9575 26H34.4905L33.1045 23.669L31.7905 26H30.3415L32.3125 22.724L30.3955 19.574H31.8355L33.1405 21.914L34.4905 19.574H35.8765L33.9235 22.796L35.9575 26ZM42.707 19.538C42.905 19.538 43.067 19.58 43.193 19.664C43.325 19.742 43.391 19.862 43.391 20.024V26H42.131V21.851L40.61 24.785H39.449L37.919 21.851V26H36.659V20.033C36.659 19.871 36.725 19.748 36.857 19.664C36.989 19.58 37.154 19.538 37.352 19.538C37.592 19.538 37.763 19.58 37.865 19.664C37.973 19.742 38.09 19.898 38.216 20.132L40.034 23.606L41.852 20.132C41.972 19.898 42.083 19.742 42.185 19.664C42.293 19.58 42.467 19.538 42.707 19.538ZM45.3197 26C45.1697 26 45.0437 25.952 44.9417 25.856C44.8457 25.754 44.7977 25.628 44.7977 25.478V19.574H46.0847V24.92H48.9377V26H45.3197Z" fill="#0083CA"/><path d="M30.9954 15C30.8367 14.9993 30.6805 14.9608 30.5397 14.8878C30.3989 14.8147 30.2774 14.7092 30.1854 14.58L25.1854 7.58C25.0791 7.43075 25.0159 7.25517 25.0026 7.07243C24.9894 6.8897 25.0265 6.70683 25.1101 6.54379C25.1937 6.38075 25.3205 6.2438 25.4766 6.1479C25.6327 6.05201 25.8122 6.00084 25.9954 6H26.9954V1C26.9954 0.734784 27.1007 0.480429 27.2883 0.292892C27.4758 0.105356 27.7302 0 27.9954 0H33.9954C34.2606 0 34.515 0.105356 34.7025 0.292892C34.89 0.480429 34.9954 0.734784 34.9954 1V6H35.9954C36.1786 6.00084 36.3581 6.05201 36.5142 6.1479C36.6703 6.2438 36.7971 6.38075 36.8807 6.54379C36.9642 6.70683 37.0014 6.8897 36.9882 7.07243C36.9749 7.25517 36.9117 7.43075 36.8054 7.58L31.8054 14.58C31.7134 14.7092 31.5919 14.8147 31.4511 14.8878C31.3102 14.9608 31.154 14.9993 30.9954 15ZM27.9354 8L30.9954 12.28L34.0554 8H33.9954C33.7302 8 33.4758 7.89464 33.2883 7.70711C33.1007 7.51957 32.9954 7.26522 32.9954 7V2H28.9954V7C28.9954 7.26522 28.89 7.51957 28.7025 7.70711C28.515 7.89464 28.2606 8 27.9954 8H27.9354Z" fill="#0083CA"/></svg>`
            ));
        }

        Promise.all(requests).then(results => {
            const links = results.filter(link => link !== null); // Remove links falhos
            acoesCell.html(links.length ? links : 'Nenhum documento disponível');
        }).catch(error => {
            console.error('Erro ao carregar documentos:', error);
            acoesCell.html('Erro ao carregar');
        });
    });
    
    tbody.closest('table').DataTable(tableConfig);
}

// Função para formatar data para a requisição (YYYY-MM-DD)
function formatarDataParaRequisicao(data) {
    const partes = data.split('-');
    return `${partes[0]}-${partes[1]}-${partes[2]}`; // Formato YYYY-MM-DD
}

// Função para formatar data para exibição na tabela (DD/MM/YYYY)
function formatarDataParaTabela(data) {
    const partes = data.split('/');
    return `${partes[0]}/${partes[1]}/${partes[2]}`; // Formato DD/MM/YYYY
}

// Função para obter o mês e o ano a partir da data
function obterMesAno(data) {
    const partes = data.split('/');
    return `${partes[1]}/${partes[2]}`; // Formato MM/YYYY
}

// Função para formatar valores em reais
function formatarValor(valor) {
    return `R$ ${parseFloat(valor).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
}